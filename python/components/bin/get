#!/usr/bin/env python3

from argparse import ArgumentParser, Namespace
from http.client import HTTPResponse
from os.path import basename
from typing import cast
from urllib.parse import urlparse
from urllib.request import build_opener


def fetch(uri: str, timeout: float) -> bytes:
    opener = build_opener()
    with opener.open(uri, timeout=timeout) as resp:
        return cast(HTTPResponse, resp).read()


def parse_args() -> Namespace:
    parser = ArgumentParser()
    parser.add_argument("src")
    parser.add_argument("-d", "--dest", default=None)
    parser.add_argument("-t", "--timeout", type=int, default=60)
    return parser.parse_args()


def main() -> None:
    args = parse_args()

    src: str = args.src
    parsed = urlparse(src)
    name = basename(parsed.path)
    dest: str = args.dest if args.dest else name

    payload = fetch(src, timeout=args.timeout)
    with open(dest, "wb") as fd:
        fd.write(payload)


main()
